# .titan/workflows/create-pr-ai.yaml
# This workflow overrides the default one from the github plugin.

name: "Create Pull Request with AI + Linter"
description: "AI-powered PR creation with an additional linting step for this project."

# Extend the base workflow from the github plugin
extends: "plugin:github/create-pr-ai"

# Use hooks to inject custom steps
hooks:
  before_commit:
    - id: ruff-fix
      name: "Auto-fix linting errors with Ruff"
      command: "ruff check . --fix"
      on_error: continue  # Try to fix, but don't fail if some errors remain
      params:
        use_venv: true
    - id: ruff-check-diff
      name: "Check for remaining linting errors in modified files"
      command: "git diff --name-only | xargs ruff check"
      on_error: fail      # Fail if there are any errors left after auto-fixing
      params:
        use_venv: true
